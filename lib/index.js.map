{"version":3,"file":"index.js","sources":["../node_modules/@vue/babel-helper-vue-jsx-merge-props/dist/helper.js","../src/index.tsx"],"sourcesContent":["\"use strict\";function _extends(){return _extends=Object.assign?Object.assign.bind():function(a){for(var b,c=1;c<arguments.length;c++)for(var d in b=arguments[c],b)Object.prototype.hasOwnProperty.call(b,d)&&(a[d]=b[d]);return a},_extends.apply(this,arguments)}var normalMerge=[\"attrs\",\"props\",\"domProps\"],toArrayMerge=[\"class\",\"style\",\"directives\"],functionalMerge=[\"on\",\"nativeOn\"],mergeJsxProps=function(a){return a.reduce(function(c,a){for(var b in a)if(!c[b])c[b]=a[b];else if(-1!==normalMerge.indexOf(b))c[b]=_extends({},c[b],a[b]);else if(-1!==toArrayMerge.indexOf(b)){var d=c[b]instanceof Array?c[b]:[c[b]],e=a[b]instanceof Array?a[b]:[a[b]];c[b]=[].concat(d,e)}else if(-1!==functionalMerge.indexOf(b)){for(var f in a[b])if(c[b][f]){var g=c[b][f]instanceof Array?c[b][f]:[c[b][f]],h=a[b][f]instanceof Array?a[b][f]:[a[b][f]];c[b][f]=[].concat(g,h)}else c[b][f]=a[b][f];}else if(\"hook\"===b)for(var i in a[b])c[b][i]=c[b][i]?mergeFn(c[b][i],a[b][i]):a[b][i];else c[b]=a[b];return c},{})},mergeFn=function(a,b){return function(){a&&a.apply(this,arguments),b&&b.apply(this,arguments)}};module.exports=mergeJsxProps;\n","/* eslint-disable @typescript-eslint/no-explicit-any */\nimport {\n  defineComponent,\n  onBeforeMount,\n  onMounted,\n  onBeforeUnmount,\n  reactive,\n  ref,\n  shallowRef,\n  watch,\n  nextTick,\n  type ShallowRef,\n} from 'vue-demi';\n\nconst ObserverItem = defineComponent({\n  name: 'ObserverItem',\n  props: {\n    resizeObserver: {\n      type: ResizeObserver,\n      require: true,\n    },\n    id: {\n      type: [String, Number],\n      require: true,\n    },\n  },\n  setup(props) {\n    const itemRefEl = ref(null);\n\n    onMounted(() => {\n      if (props.resizeObserver && itemRefEl.value) {\n        props.resizeObserver.observe(itemRefEl.value);\n      }\n    });\n\n    onBeforeUnmount(() => {\n      if (props.resizeObserver && itemRefEl.value) {\n        props.resizeObserver.unobserve(itemRefEl.value);\n      }\n    });\n\n    return {\n      itemRefEl,\n    };\n  },\n  render() {\n    const { id } = this;\n    return (\n      <div ref=\"itemRefEl\" data-id={id}>\n        {this.$slots.default}\n      </div>\n    );\n  },\n});\n\nconst VirtualList = defineComponent({\n  name: 'VirtualList',\n  props: {\n    list: {\n      type: Array<any>,\n      default: () => [],\n    },\n    // 最小尺寸\n    minSize: {\n      type: Number,\n      default: 20,\n      required: true,\n    },\n    itemComponent: {\n      type: [Object, Function],\n      required: true,\n    },\n    fixed: {\n      type: Boolean,\n      default: false,\n    },\n    // 数据key\n    itemKey: {\n      type: [String, Number],\n      required: true,\n    },\n    buffer: {\n      type: Number,\n      default: 0,\n    },\n    bufferTop: {\n      type: Number,\n      default: 0,\n    },\n    bufferBottom: {\n      type: Number,\n      default: 0,\n    },\n    // 滚动距离阈值\n    scrollDistance: {\n      type: Number,\n      default: 0,\n    },\n    // 是否为水平移动\n    horizontal: {\n      type: Boolean,\n      default: false,\n    },\n    // 起始下标\n    start: {\n      type: Number,\n      default: 0,\n    },\n    // 起始偏移量\n    offset: {\n      type: Number,\n      default: 0,\n    },\n    listStyle: {\n      type: String,\n      default: '',\n    },\n    headerClass: {\n      type: String,\n      default: '',\n    },\n    headerStyle: {\n      type: String,\n      default: '',\n    },\n    footerClass: {\n      type: String,\n      default: '',\n    },\n    footerStyle: {\n      type: String,\n      default: '',\n    },\n    stickyHeaderClass: {\n      type: String,\n      default: '',\n    },\n    stickyHeaderStyle: {\n      type: String,\n      default: '',\n    },\n    stickyFooterClass: {\n      type: String,\n      default: '',\n    },\n    stickyFooterStyle: {\n      type: String,\n      default: '',\n    },\n  },\n  setup(props, context) {\n    const clientRef = ref<typeof ObserverItem | null>(null);\n    const listRefEl = ref<HTMLElement | null>(null);\n    const sizesMap = new Map();\n    const renderKey = ref(new Date().getTime());\n    let direction: 'forward' | 'backward' = 'backward';\n    // 一个手动设置滚动的标志位，用来判断是否需要纠正滚动位置\n    let setScrollFlag = false;\n    const slotSize = {\n      clientSize: 0,\n      headerSize: 0,\n      footerSize: 0,\n      stickyHeaderSize: 0,\n      stickyFooterSize: 0,\n    };\n\n    // 全局需要响应式的数据\n    const reactiveData = reactive({\n      // 可视区域的个数，不算buffer，只和clientSize和minSize有关\n      views: 0,\n\n      // 滚动距离\n      offset: 0,\n      // 不包含插槽的高度\n      listTotalSize: 0,\n      // 虚拟占位尺寸，是从0到renderBegin的尺寸\n      virtualSize: 0,\n      // 可视区的起始下标\n      inViewBegin: 0,\n      // 可视区的结束下标\n      inViewEnd: 0,\n\n      // buffer的起始下标\n      renderBegin: 0,\n      // buffer的结束下标\n      renderEnd: 0,\n\n      bufferTop: 0,\n      bufferBottom: 0,\n    });\n\n    function getOffset() {\n      const directionKey = props.horizontal ? 'scrollLeft' : 'scrollTop';\n      return clientRef.value?.$el ? clientRef.value.$el[directionKey] : 0;\n    }\n    function getSlotSize() {\n      return (\n        slotSize.headerSize +\n        slotSize.footerSize +\n        slotSize.stickyHeaderSize +\n        slotSize.stickyFooterSize\n      );\n    }\n    function getItemSize(itemKey: string) {\n      if (props.fixed) return props.minSize;\n      return sizesMap.get(String(itemKey)) ?? props.minSize;\n    }\n    function setItemSize(itemKey: string, size: number) {\n      sizesMap.set(String(itemKey), size);\n    }\n    function deleteItemSize(itemKey: string) {\n      sizesMap.delete(String(itemKey));\n    }\n    // 通过下标来获取元素位置信息\n    function getItemPosByIndex(index: number) {\n      if (props.fixed) {\n        return {\n          top: props.minSize * index,\n          current: props.minSize,\n          bottom: props.minSize * (index + 1),\n        };\n      }\n\n      const { itemKey } = props;\n      let topReduce = slotSize.headerSize;\n      for (let i = 0; i <= index - 1; i += 1) {\n        const currentSize = getItemSize(props.list[i]?.[itemKey]);\n        topReduce += currentSize;\n      }\n      const current = getItemSize(props.list[index]?.[itemKey]);\n      return {\n        top: topReduce,\n        current,\n        bottom: topReduce + current,\n      };\n    }\n\n    function scrollToOffset(offset: number) {\n      // console.log('scrollToOffset', offset);\n      setScrollFlag = true;\n      const directionKey = props.horizontal ? 'scrollLeft' : 'scrollTop';\n      if (clientRef.value?.$el) clientRef.value.$el[directionKey] = offset;\n\n      nextTick(() => {\n        setScrollFlag = false;\n      });\n    }\n    // expose 滚动到指定下标\n    async function scrollToIndex(index: number) {\n      console.log('scrollToIndex', index);\n\n      if (index < 0) {\n        return;\n      }\n\n      // 如果要去的位置大于长度，那么就直接调用去底部的方法\n      if (index >= props.list.length - 1) {\n        scrollToBottom();\n        return;\n      }\n\n      let { top: lastOffset } = getItemPosByIndex(index);\n      const recursion = async () => {\n        scrollToOffset(lastOffset);\n\n        setTimeout(() => {\n          // 第二次看一下有没有需要修正的情况\n          const { top: offset } = getItemPosByIndex(index);\n          // 查看位置是否有修正，有修正就递归自己\n          if (lastOffset !== offset) {\n            lastOffset = offset;\n            recursion();\n          }\n        }, 3);\n      };\n      recursion();\n    }\n    // expose 滚动到可视区域\n    async function scrollIntoView(index: number) {\n      const { top: targetMin, bottom: targetMax } = getItemPosByIndex(index);\n      const offsetMin = getOffset();\n      const offsetMax = getOffset() + slotSize.clientSize;\n      const currentSize = getItemSize(props.list[index]?.[props.itemKey]);\n      if (\n        targetMin < offsetMin &&\n        offsetMin < targetMax &&\n        currentSize < slotSize.clientSize\n      ) {\n        // 如果目标元素上方看不到，底部看得到，那么滚动到顶部部看得到就行了\n        scrollToOffset(targetMin);\n        return;\n      }\n      if (\n        targetMin + slotSize.stickyHeaderSize < offsetMax &&\n        offsetMax < targetMax + slotSize.stickyHeaderSize &&\n        currentSize < slotSize.clientSize\n      ) {\n        // 如果目标元素上方看得到，底部看不到，那么滚动到底部看得到就行了\n        scrollToOffset(\n          targetMax - slotSize.clientSize + slotSize.stickyHeaderSize,\n        );\n        return;\n      }\n\n      // 屏幕下方\n      if (targetMin + slotSize.stickyHeaderSize >= offsetMax) {\n        scrollToIndex(index);\n        return;\n      }\n\n      // 屏幕上方\n      if (targetMax <= offsetMin) {\n        scrollToIndex(index);\n        return;\n      }\n\n      // 在中间就不动了\n    }\n    // expose 滚动到顶部，这个和去第一个元素不同\n    async function scrollToTop() {\n      scrollToOffset(0);\n    }\n    // expose 滚动到底部\n    async function scrollToBottom() {\n      const lastListTotalSize =\n        reactiveData.listTotalSize + slotSize.headerSize + slotSize.footerSize;\n      scrollToOffset(lastListTotalSize);\n\n      setTimeout(() => {\n        const currentSize =\n          reactiveData.listTotalSize +\n          slotSize.headerSize +\n          slotSize.footerSize;\n        if (lastListTotalSize < currentSize) {\n          scrollToBottom();\n        }\n      }, 0);\n    }\n\n    // 修复vue2-diff的bug导致的selection问题\n    function fixSelection() {\n      const selection = window.getSelection();\n      if (selection) {\n        const { anchorNode, anchorOffset, focusNode, focusOffset } = selection;\n        // console.log(\n        //   '发生变更',\n        //   selection,\n        //   anchorNode,\n        //   anchorOffset,\n        //   focusNode,\n        //   focusOffset,\n        // );\n        if (\n          anchorNode &&\n          anchorOffset !== null &&\n          focusNode !== null &&\n          focusOffset\n        ) {\n          requestAnimationFrame(() => {\n            if (anchorOffset < focusOffset) {\n              selection.setBaseAndExtent(\n                anchorNode,\n                anchorOffset,\n                focusNode,\n                focusOffset,\n              );\n            } else {\n              selection.setBaseAndExtent(\n                focusNode,\n                focusOffset,\n                anchorNode,\n                anchorOffset,\n              );\n            }\n          });\n        }\n      }\n    }\n\n    function updateRange(start: number) {\n      // 修复vue2-diff的bug\n      if (reactiveData.inViewBegin < start) {\n        fixSelection();\n      }\n\n      reactiveData.inViewBegin = start;\n      reactiveData.inViewEnd = Math.min(\n        start + reactiveData.views,\n        props.list.length,\n      );\n    }\n\n    function calcRange() {\n      const { views, offset, inViewBegin } = reactiveData;\n      const { itemKey } = props;\n\n      const offsetWithNoHeader = offset - slotSize.headerSize;\n      // 如果滚动距离还在header范围内，是不需要计算的\n      if (offsetWithNoHeader < 0) {\n        updateRange(0);\n        return;\n      }\n\n      // 进入计算\n      let start = inViewBegin;\n      let offsetReduce = getVirtualSize2beginInView();\n      if (direction === 'forward') {\n        for (let i = start - 1; i >= 0; i -= 1) {\n          // 1. 没发生变化\n          if (i === start - 1 && offsetWithNoHeader >= offsetReduce) {\n            start = i + 1;\n            // console.log(`👆🏻👆🏻👆🏻👆🏻 for break 没变 start ${start}`);\n            break;\n          }\n          // 2. 变化了\n          const currentSize = getItemSize(props.list[i]?.[itemKey]);\n          offsetReduce -= currentSize;\n          // 要计算2个header插槽的高度\n          if (\n            offsetReduce <= offsetWithNoHeader &&\n            offsetWithNoHeader < offsetReduce + currentSize\n          ) {\n            start = i;\n            // console.log(`👆🏻👆🏻👆🏻👆🏻 for break 变了 start ${start}`);\n            break;\n          }\n        }\n      } else {\n        for (let i = start; i <= props.list.length - 1; i += 1) {\n          // 1. 到底了\n          if (i >= props.list.length - views) {\n            start = i;\n            break;\n          }\n          // 2. 变化了\n          const currentSize = getItemSize(props.list[i]?.[itemKey]);\n          if (\n            offsetReduce <= offsetWithNoHeader &&\n            offsetWithNoHeader < offsetReduce + currentSize\n          ) {\n            start = i;\n            break;\n          }\n          offsetReduce += currentSize;\n        }\n      }\n\n      // 节流\n      if (start === 0 || start !== reactiveData.inViewBegin) {\n        updateRange(start);\n      }\n    }\n\n    function onScroll(evt: Event) {\n      context.emit('scroll', evt);\n\n      const offset = getOffset();\n      // console.log('onscroll', offset, reactiveData.offset);\n\n      if (offset === reactiveData.offset) return;\n      direction = offset < reactiveData.offset ? 'forward' : 'backward';\n      reactiveData.offset = offset;\n\n      calcRange();\n\n      // 到达顶部\n      if (\n        direction === 'forward' &&\n        reactiveData.offset - props.scrollDistance <= 0\n      ) {\n        console.log('[VirtualList] 到达顶部');\n        context.emit('toTop', props.list[0]);\n      }\n      // 到达底部 - 放在这里是为了渲染完成拿到真是高度了，再判断是否是真的到达底部\n      if (\n        direction === 'backward' &&\n        reactiveData.offset + props.scrollDistance >=\n          reactiveData.listTotalSize + getSlotSize() - slotSize.clientSize\n      ) {\n        console.log('[VirtualList] 到达底部');\n        context.emit('toBottom', props.list[props.list.length - 1]);\n      }\n    }\n\n    function calcViews() {\n      // 不算buffer的个数\n      const newViews = Math.ceil(slotSize.clientSize / props.minSize) + 1;\n      reactiveData.views = newViews;\n    }\n\n    function onClientResize() {\n      // 可视区域尺寸变化 => 1. 更新可视区域个数 2. 可视区域个数变化后需要及时更新记录尺寸\n      calcViews();\n      updateRange(reactiveData.inViewBegin);\n    }\n\n    function calcListTotalSize() {\n      if (props.fixed) {\n        reactiveData.listTotalSize = props.minSize * props.list.length;\n        return;\n      }\n      const { itemKey } = props;\n      let re = 0;\n      for (let i = 0; i <= props.list.length - 1; i += 1) {\n        re += getItemSize(props.list[i]?.[itemKey]);\n      }\n      reactiveData.listTotalSize = re;\n    }\n\n    function reset() {\n      console.log('[VirtualList] reset');\n\n      reactiveData.offset = 0;\n      reactiveData.listTotalSize = 0;\n      reactiveData.virtualSize = 0;\n\n      reactiveData.inViewBegin = 0;\n      reactiveData.inViewEnd = 0;\n\n      reactiveData.renderBegin = 0;\n      reactiveData.renderEnd = 0;\n\n      // fix bug: 滚动到顶部后，修改list会导致不应出现的修正误差操作\n      direction = 'backward';\n\n      sizesMap.clear();\n    }\n    // expose only\n    function decreaseTopSize(prevList: []) {\n      calcListTotalSize();\n      let prevListSize = 0;\n      prevList.forEach((item) => {\n        // console.log(item[props.itemKey], getItemSize(item[props.itemKey]));\n        prevListSize += getItemSize(item[props.itemKey]);\n      });\n      reactiveData.inViewBegin -= prevList.length;\n      reactiveData.virtualSize -= prevListSize;\n      scrollToOffset(reactiveData.offset - prevListSize);\n\n      calcRange();\n    }\n    // expose only\n    function increaseTopSize(prevList: []) {\n      calcListTotalSize();\n\n      let prevListSize = 0;\n      prevList.forEach((item) => {\n        // console.log(item[props.itemKey], getItemSize(item[props.itemKey]));\n        prevListSize += getItemSize(item[props.itemKey]);\n      });\n      reactiveData.inViewBegin += prevList.length;\n      reactiveData.virtualSize += prevListSize;\n      scrollToOffset(reactiveData.offset + prevListSize);\n\n      calcRange();\n    }\n\n    function forceUpdate() {\n      renderKey.value = new Date().getTime();\n    }\n\n    let resizeObserver: ResizeObserver | undefined = undefined;\n    if (typeof ResizeObserver !== 'undefined') {\n      resizeObserver = new ResizeObserver((entries) => {\n        // FIXME 这里加了requestIdleCallback会有问题，暂时不知道为什么\n        // 延迟执行，快速滚动的时候是没有必要的\n        // requestIdleCallback(() => {\n        let diff = 0;\n        for (const entry of entries) {\n          const id = (entry.target as HTMLElement).dataset.id;\n\n          if (id) {\n            const oldSize = getItemSize(id);\n            const newSize = props.horizontal\n              ? entry.contentBoxSize[0].inlineSize\n              : entry.contentBoxSize[0].blockSize;\n\n            if (id === 'client') {\n              slotSize.clientSize = newSize;\n              onClientResize();\n            } else if (id === 'header') {\n              slotSize.headerSize = newSize;\n            } else if (id === 'footer') {\n              slotSize.footerSize = newSize;\n            } else if (id === 'stickyHeader') {\n              slotSize.stickyHeaderSize = newSize;\n            } else if (id === 'stickyFooter') {\n              slotSize.stickyFooterSize = newSize;\n            } else if (oldSize !== newSize) {\n              setItemSize(id, newSize);\n              diff += newSize - oldSize;\n            }\n          }\n        }\n        reactiveData.listTotalSize += diff;\n        // 向上滚动纠正误差\n        if (!setScrollFlag && direction === 'forward' && diff !== 0) {\n          scrollToOffset(reactiveData.offset + diff);\n        }\n      });\n      // });\n    }\n\n    onBeforeMount(() => {\n      if (props.bufferTop) {\n        reactiveData.bufferTop = props.bufferTop;\n      } else {\n        reactiveData.bufferTop = props.buffer;\n      }\n\n      if (props.bufferBottom) {\n        reactiveData.bufferBottom = props.bufferBottom;\n      } else {\n        reactiveData.bufferBottom = props.buffer;\n      }\n    });\n\n    onMounted(() => {\n      if (clientRef.value) {\n        clientRef.value.$el.addEventListener('scroll', onScroll);\n      }\n\n      if (props.start) {\n        scrollToIndex(props.start);\n      } else if (props.offset) {\n        scrollToOffset(props.offset);\n      }\n    });\n\n    onBeforeUnmount(() => {\n      if (clientRef.value) {\n        clientRef.value.$el.removeEventListener('scroll', onScroll);\n      }\n    });\n\n    function getVirtualSize2beginInView() {\n      return (\n        reactiveData.virtualSize +\n        getRangeSize(reactiveData.renderBegin, reactiveData.inViewBegin)\n      );\n    }\n\n    function getRangeSize(range1: number, range2: number) {\n      const start = Math.min(range1, range2);\n      const end = Math.max(range1, range2);\n      let re = 0;\n      for (let i = start; i < end; i += 1) {\n        re += getItemSize(props.list[i]?.[props.itemKey]);\n      }\n      return re;\n    }\n\n    const filterList: ShallowRef<any[]> = shallowRef([]);\n    watch(\n      // 这里为什么用 renderKey 代替监听 props.list\n      // 因为props.list会导致v-for时deepArray导致大量的性能浪费\n      () => [reactiveData.inViewBegin, reactiveData.inViewEnd, renderKey.value],\n      (newVal, oldVal) => {\n        if (newVal && oldVal) {\n          // console.log('watch', newVal, oldVal);\n          const [_newInViewBegin] = newVal;\n          const [_oldInViewBegin] = oldVal;\n\n          const _oldRenderBegin = Math.max(\n            0,\n            _oldInViewBegin - reactiveData.bufferTop,\n          );\n\n          const _newRenderBegin = Math.max(\n            0,\n            _newInViewBegin - reactiveData.bufferTop,\n          );\n\n          const _newRenderEnd = Math.min(\n            reactiveData.inViewEnd + reactiveData.bufferBottom,\n            props.list.length,\n          );\n\n          // update virtualSize, diff range size\n          if (_newRenderBegin > _oldRenderBegin) {\n            reactiveData.virtualSize += getRangeSize(\n              _newRenderBegin,\n              _oldRenderBegin,\n            );\n          } else {\n            reactiveData.virtualSize -= getRangeSize(\n              _newRenderBegin,\n              _oldRenderBegin,\n            );\n          }\n\n          reactiveData.renderBegin = _newRenderBegin;\n          reactiveData.renderEnd = _newRenderEnd;\n\n          // 实际渲染的时候要用buffer的\n          filterList.value = props.list.slice(\n            reactiveData.renderBegin,\n            reactiveData.renderEnd,\n          );\n        }\n      },\n      {\n        immediate: true,\n      },\n    );\n\n    watch(\n      () => props.list.length,\n      () => {\n        // 如果数据为空，那么就重置\n        if (props.list.length <= 0) {\n          reset();\n          return;\n        }\n\n        // [require] 因为list长度变化，所以总高度有变化\n        calcListTotalSize();\n        // [require] 因为list长度变化，所以重新计算起始结束位置\n        calcRange();\n        // [require] 起始位置可能不变，但列表元素发生变化，所以强制渲染一次\n        forceUpdate();\n      },\n      {\n        immediate: true,\n      },\n    );\n\n    return {\n      props,\n\n      filterList,\n\n      clientRef,\n      listRefEl,\n      reactiveData,\n\n      getOffset,\n      reset,\n      scrollToIndex,\n      scrollIntoView,\n      scrollToTop,\n      scrollToBottom,\n      scrollToOffset,\n      getItemSize,\n      deleteItemSize,\n      // expose only\n      decreaseTopSize,\n      increaseTopSize,\n      getItemPosByIndex,\n      forceUpdate,\n      resizeObserver,\n      sizesMap,\n      // test\n      slotSize,\n    };\n  },\n  render() {\n    const {\n      props,\n      filterList,\n\n      itemKey,\n      reactiveData,\n\n      resizeObserver,\n    } = this;\n\n    const {\n      horizontal,\n      listStyle,\n      headerClass,\n      headerStyle,\n      footerClass,\n      footerStyle,\n      stickyHeaderClass,\n      stickyHeaderStyle,\n      stickyFooterClass,\n      stickyFooterStyle,\n      itemComponent,\n    } = props;\n\n    const { header, footer, stickyHeader, stickyFooter } = this.$slots;\n\n    const renderStickyHeaderSlot = () => {\n      return stickyHeader ? (\n        <ObserverItem\n          id=\"stickyHeader\"\n          resizeObserver={resizeObserver}\n          key=\"slot-sticky-header\"\n          class={stickyHeaderClass}\n          style={`position: sticky; z-index: 10; ${\n            horizontal ? 'left: 0' : 'top: 0;'\n          } ${stickyHeaderStyle}`}\n        >\n          {this.$slots.stickyHeader}\n        </ObserverItem>\n      ) : null;\n    };\n\n    const renderStickyFooterSlot = () => {\n      return stickyFooter ? (\n        <ObserverItem\n          id=\"stickyFooter\"\n          resizeObserver={resizeObserver}\n          key=\"slot-sticky-footer\"\n          class={stickyFooterClass}\n          style={`position: sticky; z-index: 10; ${\n            horizontal ? 'right: 0' : 'bottom: 0;'\n          } ${stickyFooterStyle}`}\n        >\n          {this.$slots.stickyFooter}\n        </ObserverItem>\n      ) : null;\n    };\n\n    const renderHeaderSlot = () => {\n      return header ? (\n        <ObserverItem\n          id=\"header\"\n          resizeObserver={resizeObserver}\n          key=\"slot-header\"\n          class={headerClass}\n          style={headerStyle}\n        >\n          {this.$slots.header}\n        </ObserverItem>\n      ) : null;\n    };\n\n    const renderFooterSlot = () => {\n      return footer ? (\n        <ObserverItem\n          id=\"footer\"\n          resizeObserver={resizeObserver}\n          key=\"slot-footer\"\n          class={footerClass}\n          style={footerStyle}\n        >\n          {this.$slots.footer}\n        </ObserverItem>\n      ) : null;\n    };\n\n    const { listTotalSize, virtualSize } = reactiveData;\n\n    const renderMainList = () => {\n      const mainList = [];\n      for (let index = 0; index < filterList.length; index += 1) {\n        const currentItem = filterList[index];\n        mainList.push(\n          <ObserverItem\n            id={currentItem[itemKey]}\n            resizeObserver={resizeObserver}\n            key={currentItem[itemKey]}\n          >\n            <itemComponent\n              props={{\n                itemData: currentItem,\n                ...this.$attrs,\n              }}\n              on={{\n                ...this.$listeners,\n              }}\n            ></itemComponent>\n          </ObserverItem>,\n        );\n      }\n\n      const dynamicListStyle = horizontal\n        ? `will-change: width; min-width: ${listTotalSize}px; display: flex; ${listStyle}`\n        : `will-change: height; min-height: ${listTotalSize}px; ${listStyle}`;\n\n      return (\n        <div ref=\"listRefEl\" style={dynamicListStyle}>\n          <div\n            style={\n              horizontal\n                ? `width: ${virtualSize}px; will-change: width;`\n                : `height: ${virtualSize}px; will-change: height;`\n            }\n          ></div>\n          {mainList}\n        </div>\n      );\n    };\n\n    // const renderVirtualScrollbar = () => {\n    //   return <div style={`float: left; height: ${listTotalSize}px`}></div>; // 虚拟滚动条\n    // };\n\n    return (\n      <ObserverItem\n        id=\"client\"\n        resizeObserver={resizeObserver}\n        class=\"virtual-list__client\"\n        style={`width: 100%; height: 100%; overflow: overlay;`}\n        ref=\"clientRef\"\n      >\n        {[\n          // renderVirtualScrollbar(),\n          renderStickyHeaderSlot(),\n          renderHeaderSlot(),\n          renderMainList(),\n          renderFooterSlot(),\n          renderStickyFooterSlot(),\n        ]}\n      </ObserverItem>\n    );\n  },\n});\n\nexport { VirtualList };\n"],"names":["a","h","ObserverItem","defineComponent","name","props","resizeObserver","type","ResizeObserver","require","id","String","Number","setup","itemRefEl","ref","onMounted","value","observe","onBeforeUnmount","unobserve","render","$slots","default","VirtualList","list","Array","minSize","required","itemComponent","Object","Function","fixed","Boolean","itemKey","buffer","bufferTop","bufferBottom","scrollDistance","horizontal","start","offset","listStyle","headerClass","headerStyle","footerClass","footerStyle","stickyHeaderClass","stickyHeaderStyle","stickyFooterClass","stickyFooterStyle","context","clientRef","listRefEl","sizesMap","Map","renderKey","Date","getTime","direction","setScrollFlag","slotSize","clientSize","headerSize","footerSize","stickyHeaderSize","stickyFooterSize","reactiveData","reactive","views","listTotalSize","virtualSize","inViewBegin","inViewEnd","renderBegin","renderEnd","getOffset","directionKey","$el","getSlotSize","getItemSize","get","setItemSize","size","set","deleteItemSize","delete","getItemPosByIndex","index","top","current","bottom","topReduce","i","currentSize","scrollToOffset","nextTick","scrollToIndex","console","log","length","scrollToBottom","lastOffset","recursion","setTimeout","scrollIntoView","targetMin","targetMax","offsetMin","offsetMax","scrollToTop","lastListTotalSize","fixSelection","selection","window","getSelection","anchorNode","anchorOffset","focusNode","focusOffset","requestAnimationFrame","setBaseAndExtent","updateRange","Math","min","calcRange","offsetWithNoHeader","offsetReduce","getVirtualSize2beginInView","onScroll","evt","emit","calcViews","newViews","ceil","onClientResize","calcListTotalSize","re","reset","clear","decreaseTopSize","prevList","prevListSize","forEach","item","increaseTopSize","forceUpdate","undefined","entries","diff","entry","target","dataset","oldSize","newSize","contentBoxSize","inlineSize","blockSize","onBeforeMount","addEventListener","removeEventListener","getRangeSize","range1","range2","end","max","filterList","shallowRef","watch","newVal","oldVal","_newInViewBegin","_oldInViewBegin","_oldRenderBegin","_newRenderBegin","_newRenderEnd","slice","immediate","header","footer","stickyHeader","stickyFooter","renderStickyHeaderSlot","renderStickyFooterSlot","renderHeaderSlot","renderFooterSlot","renderMainList","mainList","currentItem","push","_mergeJSXProps","itemData","$attrs","$listeners","dynamicListStyle"],"mappings":"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"}