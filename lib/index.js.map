{"version":3,"file":"index.js","sources":["../src/index.tsx"],"sourcesContent":["/* eslint-disable @typescript-eslint/no-explicit-any */\nimport {\n  defineComponent,\n  onBeforeMount,\n  onMounted,\n  onBeforeUnmount,\n  reactive,\n  ref,\n  shallowRef,\n  watch,\n  type ShallowRef,\n} from 'vue-demi';\n\nconst ObserverItem = defineComponent({\n  name: 'ObserverItem',\n  props: {\n    resizeObserver: {\n      type: ResizeObserver,\n      require: true,\n    },\n    id: {\n      type: [String, Number],\n      require: true,\n    },\n  },\n  setup(props) {\n    const itemRefEl = ref(null);\n\n    onMounted(() => {\n      if (props.resizeObserver && itemRefEl.value) {\n        props.resizeObserver.observe(itemRefEl.value);\n      }\n    });\n\n    onBeforeUnmount(() => {\n      if (props.resizeObserver && itemRefEl.value) {\n        props.resizeObserver.unobserve(itemRefEl.value);\n      }\n    });\n\n    return {\n      itemRefEl,\n    };\n  },\n  render() {\n    const { id } = this;\n    return (\n      <div ref=\"itemRefEl\" data-id={id}>\n        {this.$slots.default}\n      </div>\n    );\n  },\n});\n\nconst VirtualList = defineComponent({\n  name: 'VirtualList',\n  props: {\n    list: {\n      type: Array<any>,\n      default: () => [],\n    },\n    // 数据key\n    itemKey: {\n      type: [String, Number],\n      required: true,\n    },\n    // 最小尺寸\n    minSize: {\n      type: Number,\n      default: 20,\n      required: true,\n    },\n    fixed: {\n      type: Boolean,\n      default: false,\n    },\n    buffer: {\n      type: Number,\n      default: 0,\n    },\n    bufferTop: {\n      type: Number,\n      default: 0,\n    },\n    bufferBottom: {\n      type: Number,\n      default: 0,\n    },\n    // 滚动距离阈值\n    scrollDistance: {\n      type: Number,\n      default: 0,\n    },\n    // 是否为水平移动\n    horizontal: {\n      type: Boolean,\n      default: false,\n    },\n    // 起始下标\n    start: {\n      type: Number,\n      default: 0,\n    },\n    // 起始偏移量\n    offset: {\n      type: Number,\n      default: 0,\n    },\n    listStyle: {\n      type: String,\n      default: '',\n    },\n    headerClass: {\n      type: String,\n      default: '',\n    },\n    headerStyle: {\n      type: String,\n      default: '',\n    },\n    footerClass: {\n      type: String,\n      default: '',\n    },\n    footerStyle: {\n      type: String,\n      default: '',\n    },\n    stickyHeaderClass: {\n      type: String,\n      default: '',\n    },\n    stickyHeaderStyle: {\n      type: String,\n      default: '',\n    },\n    stickyFooterClass: {\n      type: String,\n      default: '',\n    },\n    stickyFooterStyle: {\n      type: String,\n      default: '',\n    },\n  },\n  setup(props, context) {\n    const clientRef = ref<typeof ObserverItem | null>(null);\n    const listRefEl = ref<HTMLElement | null>(null);\n    const sizesMap = new Map();\n    const renderKey = ref(new Date().getTime());\n    let direction: 'forward' | 'backward' = 'backward';\n    // 一个手动设置滚动的标志位，用来判断是否需要纠正滚动位置\n    let setScrollFlag = false;\n    const slotSize = {\n      clientSize: 0,\n      headerSize: 0,\n      footerSize: 0,\n      stickyHeaderSize: 0,\n      stickyFooterSize: 0,\n    };\n\n    // 全局需要响应式的数据\n    const reactiveData = reactive({\n      // 可视区域的个数，不算buffer，只和clientSize和minSize有关\n      views: 0,\n\n      // 滚动距离\n      offset: 0,\n      // 不包含插槽的高度\n      listTotalSize: 0,\n      // 虚拟占位尺寸，是从0到renderBegin的尺寸\n      virtualSize: 0,\n      // 可视区的起始下标\n      inViewBegin: 0,\n      // 可视区的结束下标\n      inViewEnd: 0,\n\n      // buffer的起始下标\n      renderBegin: 0,\n      // buffer的结束下标\n      renderEnd: 0,\n\n      bufferTop: 0,\n      bufferBottom: 0,\n    });\n\n    function getOffset() {\n      const directionKey = props.horizontal ? 'scrollLeft' : 'scrollTop';\n      return clientRef.value?.$el ? clientRef.value.$el[directionKey] : 0;\n    }\n    function getSlotSize() {\n      return (\n        slotSize.headerSize +\n        slotSize.footerSize +\n        slotSize.stickyHeaderSize +\n        slotSize.stickyFooterSize\n      );\n    }\n    function getItemSize(itemKey: string) {\n      if (props.fixed) return props.minSize;\n      return sizesMap.get(String(itemKey)) ?? props.minSize;\n    }\n    function setItemSize(itemKey: string, size: number) {\n      sizesMap.set(String(itemKey), size);\n    }\n    function deleteItemSize(itemKey: string) {\n      sizesMap.delete(String(itemKey));\n    }\n    // 通过下标来获取元素位置信息\n    function getItemPosByIndex(index: number) {\n      if (props.fixed) {\n        return {\n          top: props.minSize * index,\n          current: props.minSize,\n          bottom: props.minSize * (index + 1),\n        };\n      }\n\n      const { itemKey } = props;\n      let topReduce = slotSize.headerSize;\n      for (let i = 0; i <= index - 1; i += 1) {\n        const currentSize = getItemSize(props.list[i]?.[itemKey]);\n        topReduce += currentSize;\n      }\n      const current = getItemSize(props.list[index]?.[itemKey]);\n      return {\n        top: topReduce,\n        current,\n        bottom: topReduce + current,\n      };\n    }\n\n    function scrollToOffset(offset: number) {\n      // console.log('scrollToOffset', offset);\n      setScrollFlag = true;\n      const directionKey = props.horizontal ? 'scrollLeft' : 'scrollTop';\n      if (clientRef.value?.$el) clientRef.value.$el[directionKey] = offset;\n\n      setTimeout(() => {\n        setScrollFlag = false;\n      }, 0);\n    }\n    // expose 滚动到指定下标\n    async function scrollToIndex(index: number) {\n      console.log('scrollToIndex', index);\n\n      if (index < 0) {\n        return;\n      }\n\n      // 如果要去的位置大于长度，那么就直接调用去底部的方法\n      if (index >= props.list.length - 1) {\n        scrollToBottom();\n        return;\n      }\n\n      let { top: lastOffset } = getItemPosByIndex(index);\n      const recursion = async () => {\n        scrollToOffset(lastOffset);\n\n        setTimeout(() => {\n          // 第二次看一下有没有需要修正的情况\n          const { top: offset } = getItemPosByIndex(index);\n          // 查看位置是否有修正，有修正就递归自己\n          if (lastOffset !== offset) {\n            lastOffset = offset;\n            recursion();\n          }\n        }, 3);\n      };\n      recursion();\n    }\n    // expose 滚动到可视区域\n    async function scrollIntoView(index: number) {\n      const { top: targetMin, bottom: targetMax } = getItemPosByIndex(index);\n      const offsetMin = getOffset();\n      const offsetMax = getOffset() + slotSize.clientSize;\n      const currentSize = getItemSize(props.list[index]?.[props.itemKey]);\n      if (\n        targetMin < offsetMin &&\n        offsetMin < targetMax &&\n        currentSize < slotSize.clientSize\n      ) {\n        // 如果目标元素上方看不到，底部看得到，那么滚动到顶部部看得到就行了\n        scrollToOffset(targetMin);\n        return;\n      }\n      if (\n        targetMin + slotSize.stickyHeaderSize < offsetMax &&\n        offsetMax < targetMax + slotSize.stickyHeaderSize &&\n        currentSize < slotSize.clientSize\n      ) {\n        // 如果目标元素上方看得到，底部看不到，那么滚动到底部看得到就行了\n        scrollToOffset(\n          targetMax - slotSize.clientSize + slotSize.stickyHeaderSize,\n        );\n        return;\n      }\n\n      // 屏幕下方\n      if (targetMin + slotSize.stickyHeaderSize >= offsetMax) {\n        scrollToIndex(index);\n        return;\n      }\n\n      // 屏幕上方\n      if (targetMax <= offsetMin) {\n        scrollToIndex(index);\n        return;\n      }\n\n      // 在中间就不动了\n    }\n    // expose 滚动到顶部，这个和去第一个元素不同\n    async function scrollToTop() {\n      scrollToOffset(0);\n    }\n    // expose 滚动到底部\n    async function scrollToBottom() {\n      const lastListTotalSize =\n        reactiveData.listTotalSize + slotSize.headerSize + slotSize.footerSize;\n      scrollToOffset(lastListTotalSize);\n\n      setTimeout(() => {\n        const currentSize =\n          reactiveData.listTotalSize +\n          slotSize.headerSize +\n          slotSize.footerSize;\n        if (lastListTotalSize < currentSize) {\n          scrollToBottom();\n        }\n      }, 0);\n    }\n\n    // 修复vue2-diff的bug导致的selection问题\n    function fixSelection() {\n      const selection = window.getSelection();\n      if (selection) {\n        const { anchorNode, anchorOffset, focusNode, focusOffset } = selection;\n        if (\n          anchorNode &&\n          anchorOffset !== null &&\n          focusNode !== null &&\n          focusOffset &&\n          anchorNode !== focusNode\n        ) {\n          requestAnimationFrame(() => {\n            if (anchorOffset < focusOffset) {\n              selection.setBaseAndExtent(\n                anchorNode,\n                anchorOffset,\n                focusNode,\n                focusOffset,\n              );\n            } else {\n              selection.setBaseAndExtent(\n                focusNode,\n                focusOffset,\n                anchorNode,\n                anchorOffset,\n              );\n            }\n          });\n        }\n      }\n    }\n\n    function updateRange(start: number) {\n      // 修复vue2-diff的bug\n      if (reactiveData.inViewBegin < start) {\n        fixSelection();\n      }\n\n      reactiveData.inViewBegin = start;\n      reactiveData.inViewEnd = Math.min(\n        start + reactiveData.views,\n        props.list.length,\n      );\n    }\n\n    function calcRange() {\n      const { views, offset, inViewBegin } = reactiveData;\n      const { itemKey } = props;\n\n      const offsetWithNoHeader = offset - slotSize.headerSize;\n      // 如果滚动距离还在header范围内，是不需要计算的\n      if (offsetWithNoHeader < 0) {\n        updateRange(0);\n        return;\n      }\n\n      // 进入计算\n      let start = inViewBegin;\n      let offsetReduce = getVirtualSize2beginInView();\n      if (direction === 'forward') {\n        for (let i = start - 1; i >= 0; i -= 1) {\n          // 1. 没发生变化\n          if (i === start - 1 && offsetWithNoHeader >= offsetReduce) {\n            start = i + 1;\n            // console.log(`👆🏻👆🏻👆🏻👆🏻 for break 没变 start ${start}`);\n            break;\n          }\n          // 2. 变化了\n          const currentSize = getItemSize(props.list[i]?.[itemKey]);\n          offsetReduce -= currentSize;\n          // 要计算2个header插槽的高度\n          if (\n            offsetReduce <= offsetWithNoHeader &&\n            offsetWithNoHeader < offsetReduce + currentSize\n          ) {\n            start = i;\n            // console.log(`👆🏻👆🏻👆🏻👆🏻 for break 变了 start ${start}`);\n            break;\n          }\n        }\n      } else {\n        for (let i = start; i <= props.list.length - 1; i += 1) {\n          // 1. 到底了\n          if (i >= props.list.length - views) {\n            start = i;\n            break;\n          }\n          // 2. 变化了\n          const currentSize = getItemSize(props.list[i]?.[itemKey]);\n          if (\n            offsetReduce <= offsetWithNoHeader &&\n            offsetWithNoHeader < offsetReduce + currentSize\n          ) {\n            start = i;\n            break;\n          }\n          offsetReduce += currentSize;\n        }\n      }\n\n      // 节流\n      if (start === 0 || start !== reactiveData.inViewBegin) {\n        updateRange(start);\n      }\n    }\n\n    function onScroll(evt: Event) {\n      context.emit('scroll', evt);\n\n      const offset = getOffset();\n      // console.log('onscroll', offset, reactiveData.offset);\n\n      if (offset === reactiveData.offset) return;\n      direction = offset < reactiveData.offset ? 'forward' : 'backward';\n      reactiveData.offset = offset;\n\n      calcRange();\n\n      // 到达顶部\n      if (\n        direction === 'forward' &&\n        reactiveData.offset - props.scrollDistance <= 0\n      ) {\n        console.log('[VirtualList] 到达顶部');\n        context.emit('toTop', props.list[0]);\n      }\n      // 到达底部 - 放在这里是为了渲染完成拿到真是高度了，再判断是否是真的到达底部\n      if (\n        direction === 'backward' &&\n        reactiveData.offset + props.scrollDistance >=\n          reactiveData.listTotalSize + getSlotSize() - slotSize.clientSize\n      ) {\n        console.log('[VirtualList] 到达底部');\n        context.emit('toBottom', props.list[props.list.length - 1]);\n      }\n    }\n\n    function calcViews() {\n      // 不算buffer的个数\n      const newViews = Math.ceil(slotSize.clientSize / props.minSize) + 1;\n      reactiveData.views = newViews;\n    }\n\n    function onClientResize() {\n      // 可视区域尺寸变化 => 1. 更新可视区域个数 2. 可视区域个数变化后需要及时更新记录尺寸\n      calcViews();\n      updateRange(reactiveData.inViewBegin);\n    }\n\n    function calcListTotalSize() {\n      if (props.fixed) {\n        reactiveData.listTotalSize = props.minSize * props.list.length;\n        return;\n      }\n      const { itemKey } = props;\n      let re = 0;\n      for (let i = 0; i <= props.list.length - 1; i += 1) {\n        re += getItemSize(props.list[i]?.[itemKey]);\n      }\n      reactiveData.listTotalSize = re;\n    }\n\n    function reset() {\n      console.log('[VirtualList] reset');\n\n      reactiveData.offset = 0;\n      reactiveData.listTotalSize = 0;\n      reactiveData.virtualSize = 0;\n\n      reactiveData.inViewBegin = 0;\n      reactiveData.inViewEnd = 0;\n\n      reactiveData.renderBegin = 0;\n      reactiveData.renderEnd = 0;\n\n      // fix bug: 滚动到顶部后，修改list会导致不应出现的修正误差操作\n      direction = 'backward';\n\n      sizesMap.clear();\n    }\n    // expose only\n    function decreaseTopSize(prevList: []) {\n      calcListTotalSize();\n      let prevListSize = 0;\n      prevList.forEach((item) => {\n        // console.log(item[props.itemKey], getItemSize(item[props.itemKey]));\n        prevListSize += getItemSize(item[props.itemKey]);\n      });\n      reactiveData.inViewBegin -= prevList.length;\n      reactiveData.virtualSize -= prevListSize;\n      scrollToOffset(reactiveData.offset - prevListSize);\n\n      calcRange();\n    }\n    // expose only\n    function increaseTopSize(prevList: []) {\n      calcListTotalSize();\n\n      let prevListSize = 0;\n      prevList.forEach((item) => {\n        // console.log(item[props.itemKey], getItemSize(item[props.itemKey]));\n        prevListSize += getItemSize(item[props.itemKey]);\n      });\n      reactiveData.inViewBegin += prevList.length;\n      reactiveData.virtualSize += prevListSize;\n      scrollToOffset(reactiveData.offset + prevListSize);\n\n      calcRange();\n    }\n\n    function forceUpdate() {\n      renderKey.value = new Date().getTime();\n    }\n\n    let resizeObserver: ResizeObserver | undefined = undefined;\n    if (typeof ResizeObserver !== 'undefined') {\n      resizeObserver = new ResizeObserver((entries) => {\n        // FIXME 这里加了requestIdleCallback会有问题，暂时不知道为什么\n        // 延迟执行，快速滚动的时候是没有必要的\n        // requestIdleCallback(() => {\n        let diff = 0;\n        for (const entry of entries) {\n          const id = (entry.target as HTMLElement).dataset.id;\n\n          if (id) {\n            const oldSize = getItemSize(id);\n            const newSize = props.horizontal\n              ? entry.borderBoxSize[0].inlineSize\n              : entry.borderBoxSize[0].blockSize;\n\n            if (id === 'client') {\n              slotSize.clientSize = newSize;\n              onClientResize();\n            } else if (id === 'header') {\n              slotSize.headerSize = newSize;\n            } else if (id === 'footer') {\n              slotSize.footerSize = newSize;\n            } else if (id === 'stickyHeader') {\n              slotSize.stickyHeaderSize = newSize;\n            } else if (id === 'stickyFooter') {\n              slotSize.stickyFooterSize = newSize;\n            } else if (oldSize !== newSize) {\n              setItemSize(id, newSize);\n              diff += newSize - oldSize;\n            }\n          }\n        }\n        reactiveData.listTotalSize += diff;\n        // 向上滚动纠正误差\n        if (!setScrollFlag && direction === 'forward' && diff !== 0) {\n          scrollToOffset(reactiveData.offset + diff);\n        }\n      });\n      // });\n    }\n\n    onBeforeMount(() => {\n      if (props.bufferTop) {\n        reactiveData.bufferTop = props.bufferTop;\n      } else {\n        reactiveData.bufferTop = props.buffer;\n      }\n\n      if (props.bufferBottom) {\n        reactiveData.bufferBottom = props.bufferBottom;\n      } else {\n        reactiveData.bufferBottom = props.buffer;\n      }\n    });\n\n    onMounted(() => {\n      if (clientRef.value) {\n        clientRef.value.$el.addEventListener('scroll', onScroll);\n      }\n\n      if (props.start) {\n        scrollToIndex(props.start);\n      } else if (props.offset) {\n        scrollToOffset(props.offset);\n      }\n    });\n\n    onBeforeUnmount(() => {\n      if (clientRef.value) {\n        clientRef.value.$el.removeEventListener('scroll', onScroll);\n      }\n    });\n\n    function getVirtualSize2beginInView() {\n      return (\n        reactiveData.virtualSize +\n        getRangeSize(reactiveData.renderBegin, reactiveData.inViewBegin)\n      );\n    }\n\n    function getRangeSize(range1: number, range2: number) {\n      const start = Math.min(range1, range2);\n      const end = Math.max(range1, range2);\n      let re = 0;\n      for (let i = start; i < end; i += 1) {\n        re += getItemSize(props.list[i]?.[props.itemKey]);\n      }\n      return re;\n    }\n\n    const filterList: ShallowRef<any[]> = shallowRef([]);\n    watch(\n      // 这里为什么用 renderKey 代替监听 props.list\n      // 因为props.list会导致v-for时deepArray导致大量的性能浪费\n      () => [reactiveData.inViewBegin, reactiveData.inViewEnd, renderKey.value],\n      (newVal, oldVal) => {\n        if (newVal && oldVal) {\n          // console.log('watch', newVal, oldVal);\n          const [_newInViewBegin] = newVal;\n          const [_oldInViewBegin] = oldVal;\n\n          const _oldRenderBegin = Math.max(\n            0,\n            _oldInViewBegin - reactiveData.bufferTop,\n          );\n\n          const _newRenderBegin = Math.max(\n            0,\n            _newInViewBegin - reactiveData.bufferTop,\n          );\n\n          const _newRenderEnd = Math.min(\n            reactiveData.inViewEnd + reactiveData.bufferBottom,\n            props.list.length,\n          );\n\n          // update virtualSize, diff range size\n          if (_newRenderBegin > _oldRenderBegin) {\n            reactiveData.virtualSize += getRangeSize(\n              _newRenderBegin,\n              _oldRenderBegin,\n            );\n          } else {\n            reactiveData.virtualSize -= getRangeSize(\n              _newRenderBegin,\n              _oldRenderBegin,\n            );\n          }\n\n          reactiveData.renderBegin = _newRenderBegin;\n          reactiveData.renderEnd = _newRenderEnd;\n\n          // 实际渲染的时候要用buffer的\n          filterList.value = props.list.slice(\n            reactiveData.renderBegin,\n            reactiveData.renderEnd,\n          );\n        }\n      },\n      {\n        immediate: true,\n      },\n    );\n\n    watch(\n      () => props.list.length,\n      () => {\n        // 如果数据为空，那么就重置\n        if (props.list.length <= 0) {\n          reset();\n          return;\n        }\n\n        // [require] 因为list长度变化，所以总高度有变化\n        calcListTotalSize();\n        // [require] 因为list长度变化，所以重新计算起始结束位置\n        calcRange();\n        // [require] 起始位置可能不变，但列表元素发生变化，所以强制渲染一次\n        forceUpdate();\n      },\n      {\n        immediate: true,\n      },\n    );\n\n    return {\n      props,\n\n      filterList,\n\n      clientRef,\n      listRefEl,\n      reactiveData,\n\n      getOffset,\n      reset,\n      scrollToIndex,\n      scrollIntoView,\n      scrollToTop,\n      scrollToBottom,\n      scrollToOffset,\n      getItemSize,\n      deleteItemSize,\n      // expose only\n      decreaseTopSize,\n      increaseTopSize,\n      getItemPosByIndex,\n      forceUpdate,\n      resizeObserver,\n      sizesMap,\n      // test\n      slotSize,\n    };\n  },\n  render() {\n    const {\n      props,\n      filterList,\n\n      itemKey,\n      reactiveData,\n\n      resizeObserver,\n    } = this;\n\n    const {\n      horizontal,\n      listStyle,\n      headerClass,\n      headerStyle,\n      footerClass,\n      footerStyle,\n      stickyHeaderClass,\n      stickyHeaderStyle,\n      stickyFooterClass,\n      stickyFooterStyle,\n    } = props;\n\n    const { header, footer, stickyHeader, stickyFooter } = this.$slots;\n\n    const renderStickyHeaderSlot = () => {\n      return stickyHeader ? (\n        <ObserverItem\n          id=\"stickyHeader\"\n          resizeObserver={resizeObserver}\n          key=\"slot-sticky-header\"\n          class={stickyHeaderClass}\n          style={`position: sticky; z-index: 10; ${\n            horizontal ? 'left: 0' : 'top: 0;'\n          } ${stickyHeaderStyle}`}\n        >\n          {this.$slots.stickyHeader}\n        </ObserverItem>\n      ) : null;\n    };\n\n    const renderStickyFooterSlot = () => {\n      return stickyFooter ? (\n        <ObserverItem\n          id=\"stickyFooter\"\n          resizeObserver={resizeObserver}\n          key=\"slot-sticky-footer\"\n          class={stickyFooterClass}\n          style={`position: sticky; z-index: 10; ${\n            horizontal ? 'right: 0' : 'bottom: 0;'\n          } ${stickyFooterStyle}`}\n        >\n          {this.$slots.stickyFooter}\n        </ObserverItem>\n      ) : null;\n    };\n\n    const renderHeaderSlot = () => {\n      return header ? (\n        <ObserverItem\n          id=\"header\"\n          resizeObserver={resizeObserver}\n          key=\"slot-header\"\n          class={headerClass}\n          style={headerStyle}\n        >\n          {this.$slots.header}\n        </ObserverItem>\n      ) : null;\n    };\n\n    const renderFooterSlot = () => {\n      return footer ? (\n        <ObserverItem\n          id=\"footer\"\n          resizeObserver={resizeObserver}\n          key=\"slot-footer\"\n          class={footerClass}\n          style={footerStyle}\n        >\n          {this.$slots.footer}\n        </ObserverItem>\n      ) : null;\n    };\n\n    const { listTotalSize, virtualSize } = reactiveData;\n\n    const renderMainList = () => {\n      const mainList = [];\n      for (let index = 0; index < filterList.length; index += 1) {\n        const currentItem = filterList[index];\n        mainList.push(\n          <ObserverItem\n            id={currentItem[itemKey]}\n            resizeObserver={resizeObserver}\n            key={currentItem[itemKey]}\n          >\n            {this.$scopedSlots?.default?.({ itemData: currentItem })}\n          </ObserverItem>,\n        );\n      }\n\n      const dynamicListStyle = horizontal\n        ? `will-change: width; min-width: ${listTotalSize}px; display: flex; ${listStyle}`\n        : `will-change: height; min-height: ${listTotalSize}px; ${listStyle}`;\n\n      return (\n        <div ref=\"listRefEl\" style={dynamicListStyle}>\n          <div\n            style={\n              horizontal\n                ? `width: ${virtualSize}px; will-change: width;`\n                : `height: ${virtualSize}px; will-change: height;`\n            }\n          ></div>\n          {mainList}\n        </div>\n      );\n    };\n\n    // const renderVirtualScrollbar = () => {\n    //   return <div style={`float: left; height: ${listTotalSize}px`}></div>; // 虚拟滚动条\n    // };\n\n    return (\n      <ObserverItem\n        id=\"client\"\n        resizeObserver={resizeObserver}\n        class=\"virtual-list__client\"\n        style={`width: 100%; height: 100%; overflow: overlay;`}\n        ref=\"clientRef\"\n      >\n        {[\n          // renderVirtualScrollbar(),\n          renderStickyHeaderSlot(),\n          renderHeaderSlot(),\n          renderMainList(),\n          renderFooterSlot(),\n          renderStickyFooterSlot(),\n        ]}\n      </ObserverItem>\n    );\n  },\n});\n\nexport { VirtualList };\n"],"names":["ObserverItem","defineComponent","name","props","resizeObserver","type","ResizeObserver","require","id","String","Number","setup","itemRefEl","ref","onMounted","value","observe","onBeforeUnmount","unobserve","render","h","$slots","default","VirtualList","list","Array","itemKey","required","minSize","fixed","Boolean","buffer","bufferTop","bufferBottom","scrollDistance","horizontal","start","offset","listStyle","headerClass","headerStyle","footerClass","footerStyle","stickyHeaderClass","stickyHeaderStyle","stickyFooterClass","stickyFooterStyle","context","clientRef","listRefEl","sizesMap","Map","renderKey","Date","getTime","direction","setScrollFlag","slotSize","clientSize","headerSize","footerSize","stickyHeaderSize","stickyFooterSize","reactiveData","reactive","views","listTotalSize","virtualSize","inViewBegin","inViewEnd","renderBegin","renderEnd","getOffset","directionKey","$el","getSlotSize","getItemSize","get","setItemSize","size","set","deleteItemSize","delete","getItemPosByIndex","index","top","current","bottom","topReduce","i","currentSize","scrollToOffset","setTimeout","scrollToIndex","console","log","length","scrollToBottom","lastOffset","recursion","scrollIntoView","targetMin","targetMax","offsetMin","offsetMax","scrollToTop","lastListTotalSize","fixSelection","selection","window","getSelection","anchorNode","anchorOffset","focusNode","focusOffset","requestAnimationFrame","setBaseAndExtent","updateRange","Math","min","calcRange","offsetWithNoHeader","offsetReduce","getVirtualSize2beginInView","onScroll","evt","emit","calcViews","newViews","ceil","onClientResize","calcListTotalSize","re","reset","clear","decreaseTopSize","prevList","prevListSize","forEach","item","increaseTopSize","forceUpdate","undefined","entries","diff","entry","target","dataset","oldSize","newSize","borderBoxSize","inlineSize","blockSize","onBeforeMount","addEventListener","removeEventListener","getRangeSize","range1","range2","end","max","filterList","shallowRef","watch","newVal","oldVal","_newInViewBegin","_oldInViewBegin","_oldRenderBegin","_newRenderBegin","_newRenderEnd","slice","immediate","header","footer","stickyHeader","stickyFooter","renderStickyHeaderSlot","renderStickyFooterSlot","renderHeaderSlot","renderFooterSlot","renderMainList","mainList","currentItem","push","$scopedSlots","itemData","dynamicListStyle"],"mappings":"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"}