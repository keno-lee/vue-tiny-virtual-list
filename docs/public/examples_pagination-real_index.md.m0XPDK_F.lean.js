import{p as ls,a as L,b as $,O as us}from"./chunks/ObserverItem.Ik21bs68.js";import{d as X,a6 as b,h as o,a7 as hs,y as fs,a8 as Bs,C as Ds,j as Es,a9 as As,o as K,c as H,k as r,t as x,_ as ms,I as j,a5 as vs,w as M,m as Ss,P as ks,D as _s,a as rs,R as zs}from"./chunks/framework.UVXzjgAp.js";import{a as V}from"./chunks/common.ag3T3Vnt.js";const ws={itemKey:"id",miniSize:40,list:[],scrollDistance:100,headerClass:"",headerStyle:"",footerClass:"",footerStyle:"",stickyHeaderClass:"",stickyHeaderStyle:"",stickyFooterClass:"",stickyFooterStyle:""},Ts=(f,i)=>{const s=new Proxy(f,{get(a,t){return Reflect.get(a,t)??Reflect.get(ws,t)}}),h=o(null),c=o(null),D=o(null),A=o(null),m=o(null),y=o(null),F=new Map,B=new Map,l=hs({clientSize:0,headerSize:0,footerSize:0,stickyHeaderSize:0,stickyFooterSize:0}),d=hs({listTotalSize:0,begin:"",end:""}),z=o(!1),w=o(!1),q=o(!1),G=()=>{var k;const{itemKey:a}=s;let t=0;for(let E=0;E<=s.list.length-1;E+=1)t+=T((k=s.list[E])==null?void 0:k[a]);d.listTotalSize=t},T=a=>F.get(String(a))??s.minSize,U=(a,t)=>{F.set(String(a),t)},v=()=>h.value?h.value.scrollTop:0;let n;typeof ResizeObserver<"u"&&(n=new ResizeObserver(a=>{var E;let t=0;for(const e of a){const{id:p}=e.target.dataset;if(p){const _=T(p),g=e.contentBoxSize[0].blockSize;p==="client"?l.clientSize=g:p==="header"?l.headerSize=g:p==="footer"?l.footerSize=g:p==="stickyHeader"?l.stickyHeaderSize=g:p==="stickyFooter"?l.stickyFooterSize=g:_!==g&&(U(p,g),t+=g-_,(E=i==null?void 0:i.itemResize)==null||E.call(i,p,g))}}if(d.listTotalSize+=t,G(),R(),q.value){z.value&&as("forward"),w.value&&as("backward");return}const k=v();Z(k)}));const C=a=>B.get(String(a))??-1,P=(a,t)=>{B.set(String(a),t)},R=()=>{var k,E;const{itemKey:a}=s;B.clear();let t=0;for(let e=0;e<s.list.length;e+=1)P((k=s.list[e])==null?void 0:k[a],t),t+=T((E=s.list[e])==null?void 0:E[a])},I=()=>l.headerSize+l.stickyFooterSize+l.stickyHeaderSize,ds=(a,t)=>{let k;return function(){clearTimeout(k),k=setTimeout(()=>a(),t)}};let Y="";const gs=ds(()=>{var a;Y=is(),(a=i==null?void 0:i.updateCurrent)==null||a.call(i,Y)},200),Z=a=>{var t,k;s.list.length<=0||(a<=s.scrollDistance&&(d.begin=s.list[0][s.itemKey],s.list.length>s.pageSize?d.end=s.list[s.list.length-s.pageSize-1][s.itemKey]:d.end=s.list[s.list.length-1][s.itemKey],(t=i==null?void 0:i.toTop)==null||t.call(i,s.list[0]),w.value=!1,z.value=!0),a+s.scrollDistance>=d.listTotalSize+I()-l.clientSize&&(d.end=s.list[s.list.length-1][s.itemKey],s.list.length>s.pageSize?d.begin=s.list[s.pageSize][s.itemKey]:d.begin=s.list[0][s.itemKey],(k=i==null?void 0:i.toBottom)==null||k.call(i,s.list[s.list.length-1]),w.value=!0,z.value=!1))},ss=a=>{var k;if((k=i==null?void 0:i.scroll)==null||k.call(i,a),s.list.length<=0)return;const t=v();if(q.value){const E=C(d.begin);t<E&&S(E);return}gs(),Z(t)},S=a=>{const t="scrollTop";h.value&&(h.value[t]=a)},ys=a=>{var E;const t=C((E=s.list[a])==null?void 0:E[s.itemKey]),k=async(e,p)=>{var ns;if(e===-1){setTimeout(()=>{var ts;const Cs=C((ts=s.list[a])==null?void 0:ts[s.itemKey]);k(Cs,p)},3);return}const _=T((ns=s.list[a])==null?void 0:ns[s.itemKey]),g=e+_,J=v(),Q=v()+l.clientSize;if(e<J&&J<g&&_<l.clientSize){S(e+l.headerSize),p();return}if(e+l.stickyHeaderSize<Q&&Q<g+l.stickyHeaderSize&&_<l.clientSize){S(g-l.clientSize+l.stickyHeaderSize),p();return}if(e+l.stickyHeaderSize>=Q){await O(a),p();return}g<=J&&await O(a),p()};return new Promise(e=>{k(t,e)})},os=a=>{var k;const t=(k=s.list[a])==null?void 0:k[s.itemKey];return C(t)},is=()=>{let a="";const t=v(),k=t+l.stickyHeaderSize-l.headerSize,E=k<0?0:k;for(const[e,p]of B)if(p<=E&&p+T(e)>t){a=e;break}return a},O=a=>{var E;if(a<0)return;if(a>=s.list.length-1){cs();return}const t=C((E=s.list[a])==null?void 0:E[s.itemKey]),k=(e,p)=>{if(e===-1){setTimeout(()=>{var g;const _=C((g=s.list[a])==null?void 0:g[s.itemKey]);k(_,p)},3);return}S(e+l.headerSize),p()};return new Promise(e=>{k(t,e)})},cs=()=>{const a=d.listTotalSize+l.headerSize+l.footerSize;S(a)};let N=0;const as=a=>{h.value&&S(a==="forward"?N+C(d.begin):N)},Fs=()=>{d.listTotalSize=0,d.begin="",d.end="",F.clear(),B.clear()};return fs(()=>s.list,()=>{q.value=!0},{deep:!1}),Bs(()=>{z.value&&(N=v()),w.value&&(N=v()-B.get(String(d.begin)))}),Ds(()=>{setTimeout(()=>{q.value=!1},10)}),Es(()=>{h.value&&(h.value.addEventListener("scroll",ss),n==null||n.observe(h.value)),m.value&&(n==null||n.observe(m.value)),y.value&&(n==null||n.observe(y.value)),D.value&&(n==null||n.observe(D.value)),A.value&&(n==null||n.observe(A.value))}),As(()=>{h.value&&(h.value.removeEventListener("scroll",ss),n==null||n.unobserve(h.value),l.clientSize=0),m.value&&(n==null||n.unobserve(m.value),l.stickyHeaderSize=0),y.value&&(n==null||n.unobserve(y.value),l.stickyFooterSize=0),D.value&&(n==null||n.unobserve(D.value),l.headerSize=0),A.value&&(n==null||n.unobserve(A.value),l.footerSize=0)}),{props:s,resizeObserver:n,sizesMap:F,slotSize:l,clientRefEl:h,listRefEl:c,headerRefEl:D,footerRefEl:A,stickyHeaderRefEl:m,stickyFooterRefEl:y,scrollIntoView:ys,scrollToIndex:O,reset:Fs,getItemOffset:C,getCurrentFirstItem:is,getOffsetByIndex:os,scrollToOffset:S}},bs=X({name:"RealList",props:{itemKey:{type:[String,Number],default:"id"},list:{type:Array,default:()=>[]},minSize:{type:Number,default:40},pageSize:{type:Number,default:30},scrollDistance:{type:Number,default:100},headerClass:{type:String,default:""},headerStyle:{type:String,default:""},footerClass:{type:String,default:""},footerStyle:{type:String,default:""},stickyHeaderClass:{type:String,default:""},stickyHeaderStyle:{type:String,default:""},stickyFooterClass:{type:String,default:""},stickyFooterStyle:{type:String,default:""}},setup(f,i){return Ts(f,{scroll:h=>{i.emit("scroll",h)},toTop:h=>{i.emit("toTop",h)},toBottom:h=>{i.emit("toBottom",h)},itemResize:(h,c)=>{i.emit("itemResize",h,c)},updateCurrent:h=>{i.emit("updateCurrent",h)}})},render(){const{props:f,resizeObserver:i}=this,{itemKey:s,headerClass:h,headerStyle:c,footerClass:D,footerStyle:A,stickyHeaderClass:m,stickyHeaderStyle:y,stickyFooterClass:F,stickyFooterStyle:B}=f,{header:l,footer:d,stickyHeader:z,stickyFooter:w}=this.$slots,q=()=>z?b("div",L({key:"slot-sticky-header",class:m,style:`position: sticky; z-index: 10; 'top: 0; ${y}`,ref:"stickyHeaderRefEl"},{"data-id":"stickyHeader"}),[$(z)]):null,G=()=>w?b("div",L({key:"slot-sticky-footer",class:F,style:`position: sticky; z-index: 10; bottom: 0; ${B}`,ref:"stickyFooterRefEl"},{"data-id":"stickyFooter"}),[$(w)]):null,T=()=>l?b("div",L({key:"slot-header",class:h,style:c,ref:"headerRefEl"},{"data-id":"header"}),[$(l)]):null,U=()=>d?b("div",L({key:"slot-footer",class:D,style:A,ref:"footerRefEl"},{"data-id":"footer"}),[$(d)]):null,v=()=>{var C,P;const n=[];for(let R=0;R<f.list.length;R++){const I=f.list[R];n.push(b(us,L({key:I[s]},{id:I[s],resizeObserver:i}),ls([(P=(C=this.$slots).default)==null?void 0:P.call(C,{itemData:I})])))}return b("div",{ref:"listRefEl"},[n])};return b("div",L({ref:"clientRefEl",style:"width: 100%; height: 100%; overflow: overlay;"},{"data-id":"client"}),ls([q(),T(),v(),U(),G()]))}}),xs={class:"row-item"},qs={class:"row-message"},Ls=X({__name:"Item",props:{itemData:{}},setup(f){return(i,s)=>(K(),H("div",xs,[r("div",qs,x(i.itemData.index)+" - "+x(i.itemData.id)+" - "+x(i.itemData.text),1)]))}}),Rs=ms(Ls,[["__scopeId","data-v-9506c4c3"]]),Is={class:"demo-table",style:{display:"flex","flex-direction":"column","align-items":"center"}},Ks={style:{padding:"10px 0"}},Hs=r("span",null,"   ",-1),Ps=r("span",null,"   ",-1),Ns=r("span",null,"   ",-1),$s=r("span",null,"   ",-1),Vs={class:"demo"},Ms=r("div",{style:{width:"100%",height:"20px",display:"flex","justify-content":"center","align-items":"center","background-color":"chocolate"}}," 加载中... ",-1),js={style:{width:"100%",height:"20px",display:"flex","justify-content":"center","align-items":"center","background-color":"chocolate"}},Gs={key:0},Us={key:1},es=10,W=1,u=40,ps="id",Os=X({__name:"Main",setup(f){const i=o([]),s=o(1),h=o(""),c=o(!1),D=async()=>{if(console.log("onTop"),c.value||s.value<=1)return;c.value=!0;const F=(await V(u,(s.value-2)*u,1e3)).concat(i.value.slice(0,u));i.value=F,ks(()=>{s.value-=1,c.value=!1})},A=async()=>{if(console.log("onToBottom"),c.value)return;if(s.value+W>=es){console.warn("已到最大页码",s.value);return}c.value=!0,s.value+=1;const y=await V(u,(s.value-1)*u,1e3);i.value.splice(0,u),i.value=i.value.concat(y),ks(()=>{c.value=!1})},m=y=>{h.value=y};return Es(async()=>{const y=await V(u,(s.value-1)*u),F=await V(u,s.value*u);i.value=y.concat(F),h.value=i.value[0][ps]}),(y,F)=>(K(),H("div",Is,[r("div",Ks,[r("span",null,"Total: "+x(i.value.length),1),Hs,r("span",null,"First Item In View: "+x(h.value),1),Ps,r("span",null,"currentBeginPage: "+x(s.value),1),Ns,r("span",null,"currentEndPage: "+x(s.value+W),1),$s]),r("div",Vs,[j(Ss(bs),{ref:"normalListRef",minSize:44,list:i.value,pageSize:u,onToTop:D,onToBottom:A,onUpdateCurrent:m,itemKey:ps,listStyle:"width: 1500px;"},vs({default:M(({itemData:B})=>[j(Rs,{itemData:B},null,8,["itemData"])]),footer:M(()=>[r("div",js,[s.value+W<=es-1?(K(),H("div",Gs,"加载中...")):(K(),H("div",Us,"到底了...."))])]),_:2},[s.value>1?{name:"header",fn:M(()=>[Ms]),key:"0"}:void 0]),1032,["list"])])]))}}),Js=r("h1",{id:"分页-真实列表",tabindex:"-1"},[rs("分页-真实列表 "),r("a",{class:"header-anchor",href:"#分页-真实列表","aria-label":'Permalink to "分页-真实列表"'},"​")],-1),Qs=r("ul",null,[r("li",null,"分页: 列表数据采用上下分页的形式，永远只缓存当前页数据和缓冲数据（例如：pageSize为20时，缓存数据为40）"),r("li",null,"真实列表 RealList : 缓存的数据全部真实渲染出来")],-1),Ws=r("h2",{id:"基础使用",tabindex:"-1"},[rs("基础使用 "),r("a",{class:"header-anchor",href:"#基础使用","aria-label":'Permalink to "基础使用"'},"​")],-1),Xs=zs("",1),ai=JSON.parse('{"title":"分页-真实列表","description":"","frontmatter":{},"headers":[],"relativePath":"examples/pagination-real/index.md","filePath":"examples/pagination-real/index.md"}'),Ys={name:"examples/pagination-real/index.md"},ni=Object.assign(Ys,{setup(f){return(i,s)=>{const h=_s("ClientOnly");return K(),H("div",null,[Js,Qs,Ws,j(h,null,{default:M(()=>[j(Os)]),_:1}),Xs])}}});export{ai as __pageData,ni as default};
